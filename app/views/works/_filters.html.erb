<%- form_tag(works_path, :class => 'story-filters', :method => :get) do -%>
  <%- field_set_tag 'Filter stories by: ' do -%>
		<dl class="story-filters">
			<%- if @user && @user.pseuds.count > 1 -%>
      <dt onclick='toggleFilters("filter-pseuds")'>Pseud</dt>
      <dd id="filter-pseuds" class="filter-tags">
        <ul>
          <%- for pseud in @user.pseuds -%>
					<%- if pseud.works.count > 0 -%>
          <li>
    	      <%= check_box_tag 'pseuds[]', pseud.name, @selected_tags.include?(pseud.name) %>
    	      <%= label_tag "pseuds[#{pseud.name}]", pseud.name %>  
  	      </li>
					<%- end -%>
          <%- end -%> 
        </ul>
      </dd>			
			<%- end -%>
      <%- @filters.each_pair do |tag_category, tags| -%>
				<%- unless tag_category.blank? || tags.blank? -%>
	      <dt onclick='toggleFilters("tag_category_<%= tag_category.id %>")'><%= tag_category.name %></dt>
	      <dd id="tag_category_<%= tag_category.id %>" class="filter-tags">
	        <ul>
	          <%- for tag in tags -%>
	          <li>
	            <%= check_box_tag tag_category.name + '[]', tag.name, @selected_tags.include?(tag.name) %>
	            <%= label_tag tag_category.name + "[#{tag.name}]", tag.name %>  
	          </li>
	          <%- end -%> 
	        </ul>
	      </dd>
				<%- end -%>
			<%- end -%>
		</dl>
		<p><%= hidden_field_tag("query", @query) if @query %></p>
		<p><%= hidden_field_tag("tag_id", @tag.id) if @tag %></p>
		<p><%= hidden_field_tag("user_id", @user.login) if @user %></p>
		<p class="submit"><%= submit_tag "Filter Stories" %></p>
  <%- end -%>
<%- end -%>
