<p>
<%= link_to_function(h('Upload from an existing URL?').t, 
		"Element.toggle('upload-work-form'); Element.toggle('story-form')", 
		:href => url_for(:controller => :work, :action => :upload_form)) -%>
</p>

<div id="upload-work-form" style="display: none;"> 
  <%= render :partial => 'works/upload_work_form' -%>   
</div>

<div id="story-form">
<%- form_for(@work, :html => {:name => "storyForm"}) do |f| -%> 

  <%= render :partial => 'work_tags_form' -%>
  
  <fieldset>
    <legend><%= 'Story Preface'.t -%></legend>
    <dl id="story-preface">
      <dt class="story-title">
        <%= f.label :title, h("Add Title".t), :class => "required" %>
      </dt>
      <dd class="story-title">
        <%= f.text_field :title, :class => "storyinputfield" %>
        <%= link_to_help "story-title" -%>
      </dd>
      		  
      <dt class="story-author" <%= @pseuds.size > 1 ? "" : 'style="display: none;"' -%>>
        <%= label :pseud, :id, h("Select author/pseudonym(s)").t %>
      </dt>
      <dd class="story-author" <%= @pseuds.size > 1 ? "" : 'style="display: none;"' -%>>
     	  <select name="work[author_attributes][ids][]" multiple="multiple">
          <%= options_from_collection_for_select(@pseuds, :id, :name, @selected_pseuds) %>
        </select>	 
      </dd>
      <dd class="story-author" <%= @pseuds.size > 1 ? "" : 'style="display: none;"' -%>>
        <%= link_to h('Create pseud?').t, new_user_pseud_path(current_user) %>
      </dd>  
      
      <dt class="story-author">
        <%= link_to_function(h('Add co-authors?').t, "Element.toggle('co-authors')") %>          
      </dt>

      <dd id="co-authors">
     	    <%= f.label :storycoauthor, 'Enter co-author name(s):'.t %>
         	<%= text_field_with_auto_complete :pseud, :byline, { :size => 50 }, 
              { :url => {:controller => 'pseuds', :action => 'choose_coauthors'}, :method => :get, :param_name => 'search', 
                :tokens => ',', :min_chars => 2, :skip_style => true } %>            
      </dd>
      
      <dt class="story-summary">
        <%= f.label :summary, "Summary (max %d letters)"/ArchiveConfig.SUMMARY_MAX %>
      </dt>
      <dd class="story-summary">
        <%= f.text_area :summary, :class => "summary-field" %>
      </dd>

      <dt class="story-notes">
        <%= f.label :notes, "Notes (max %d letters)"/ArchiveConfig.NOTES_MAX %>
      </dt>
      <dd class="story-notes">
        <%= f.text_area :notes, :class => "notes-field" %>
      </dd>
		<dt class="story-parent">
        <%=h "If your story is a remix or was inspired by another story in the archive, copy and paste that story's url below:".t %>
      </dt>
      <dd class="story-parent">
        <%= f.text_field :parent_url %>
      </dd>

    	<!-- Privacy dropdown (storyprivacy) -->
    	<dt class="story-restricted">
        <%= f.label :restricted, h("Only make my story visible to registered users").t %>
      </dt>
      <dd class="story-restricted">
        <%= f.check_box :restricted %>
        <%= link_to_help "registered-users" -%>
      </dd>

      <dt class="story-is_serial">
        <%=h 'Is this part of a series?'.t %> 
      </dt>
   	  <dd>
       	<input type="checkbox" id="storyseriescheck" name="storyseriescheck"  onclick="showWorkSeriesOptions()" 
         <%- unless @work.series.blank? -%>checked="checked"<%- end -%>/>
      </dd>
 <!-- Series checkbox (storyseriescheck) -->
  <!-- Checking this box causes the "manage series" dropdown to appear; unchecking it causes it to disappear. -->
 <!-- Toggles on with series checkbox -->
  <dd id="seriesmanage">
    <fieldset>
      <legend><%= 'Manage Series'.t -%></legend>
      <dl>
        <% fields_for "work[series_attributes]" do |s| %>
          <dt><%= s.label 'series_id', h('Choose one of your existing series:').t %></dt>
          <dd>
            <%= s.collection_select(:id, @series, :id, :title, {:prompt => true}) %>
            <%= link_to_help "choosing-series" -%>
          </dd>
          <dt><%= s.label :title, h("Or add a new one:").t %></dt>
          <dd><%= s.text_field :title, :class => "storyinputfield" %></dd>
    	  <%- end -%>
      	
      	<%- unless @serial_works.blank? -%>
      	  <dt><%= 'Current Series'.t -%></dt>
      	  <%- for serial in @serial_works -%>
      	    <dd>
      	      <ul class="navigation">
				        <li><%= link_to serial.series.title, serial.series %></li> 
      	      	<li><%= link_to 'Remove'.t, serial, :confirm => 'Are you sure?'.t, :method => :delete %></li> 
      	      	<li><%= link_to 'Delete'.t, serial.series, :confirm => 'Are you sure?'.t, :method => :delete %></li>
			        </ul>
      	    </dd>
    	    <%- end -%>
    	  <%- end -%>          
      </dl>
     </fieldset> 
  </dd>
</dl>
</fieldset>

  <% fields_for_associated('work', @work.chapters.first) do |c| %>
    <fieldset>
      <legend><%= "Add Chapters".t -%></legend>
      <dl>
        <!-- Chaptered checkbox (work_is_wip) -->
        <!-- Checking this box causes the expected number of chapters box to appear; unchecking it causes it to disappear. -->
        <dt class="story-is_wip">
          <%=h 'Does this work have multiple chapters?'.t %>
        </dt>
        <dd class="story-is_wip">
          <input type="checkbox" name="isWip"  
           onclick="showChapteredStoryOptions()" <%- if @work.chaptered? -%>checked="checked"<%- end -%>/>
        </dd>        
      <dd id="number-of-chapters">
        <p>
          <%=h 'Chapter 1 of'.t %> <%= f.text_field :wip_length, :class => "number-field" %> 
          <%=h 'Title:'.t %> <%= c.text_field :title %>
        </p>
      </dd> 
	</dl>         
    </fieldset>

    <!-- Story text field (chapter_attributes_content) -->
    <fieldset>
      <legend><%= 'Story Text'.t -%></legend>
      <p>
        <%= c.label :content, h("Story, in plain text with limited HTML*").t, :class => "required" %>
      </p>
      <p class="rtf-html-switch">
    	  <% use_tinymce -%>
        <span><a href="javascript:addEditor('content');"><%=h 'Rich text'.t %></a></span>
        <span><a href="javascript:removeEditor('content');">HTML</a></span>
      </p>      
      <p>
    		<%= c.text_area :content, :class => "mce-editor", :id => "content" %>
      </p>      
    </fieldset>
  <%- end -%>

  <fieldset>
    <legend><%= 'Post Story'.t -%></legend>
    <p class="submit">
      <input value="<%= 'Reset'.t -%>" type="reset">
      <%= submit_tag 'Preview'.t, :name => 'preview_button' %>
      <%= submit_tag 'Cancel'.t, :name => 'cancel_button' %>
    </p> 
  </fieldset>
<%- end -%>

</div>
